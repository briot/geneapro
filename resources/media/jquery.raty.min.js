/**
 * jQuery Raty - A Star Rating Plugin - http://wbotelhos.com/raty
 * 
 * @author  Washington Botelho
 * @twitter wbotelhos
 * @version 1.3.2
 * 
 * Licensed under The MIT License
 * http://opensource.org/licenses/mit-license.php
 * 
 */

(function(g){g.fn.raty=function(n){options=g.extend({},g.fn.raty.defaults,n);if(this.length==0){d("Selector invalid or missing!");return;}else{if(this.length>1){return this.each(function(){g.fn.raty.apply(g(this),[n]);});}}if(options.number>20){options.number=20;}else{if(options.number<0){options.number=0;}}if(options.path.substring(options.path.length-1,options.path.length)!="/"){options.path+="/";}$global=g(this);$global.data("options",options);var k=this.attr("id"),l=0,s=options.starOn,o="",m=(options.width)?options.width:(options.number*options.size+options.number*4);if(k==""){k="raty-"+$global.index();$global.attr("id",k);}if(!isNaN(options.start)&&options.start>0){l=(options.start>options.number)?options.number:options.start;}for(var p=1;p<=options.number;p++){s=(l>=p)?options.starOn:options.starOff;o=(p<=options.hintList.length&&options.hintList[p-1]!==null)?options.hintList[p-1]:p;$global.append('<img id="'+k+"-"+p+'" src="'+options.path+s+'" alt="'+p+'" title="'+o+'" class="'+k+'"/>').append((p<options.number)?"&nbsp;":"");}g("<input/>",{id:k+"-score",type:"hidden",name:options.scoreName}).appendTo($global).val(l);if(options.half){b($global,g("input#"+k+"-score").val(),options);}if(!options.readOnly){if(options.cancel){var q=g("img."+k),t='<img src="'+options.path+options.cancelOff+'" alt="x" title="'+options.cancelHint+'" class="button-cancel"/>',j=options,r=$global;if(j.cancelPlace=="left"){$global.prepend(t+"&nbsp;");}else{$global.append("&nbsp;").append(t);}g("#"+k+" img.button-cancel").mouseenter(function(){g(this).attr("src",j.path+j.cancelOn);q.attr("src",j.path+j.starOff);}).mouseleave(function(){g(this).attr("src",j.path+j.cancelOff);q.mouseout();}).click(function(){g("input#"+k+"-score").val(0);if(j.click){j.click.apply(r,[0]);}});$global.css("width",m+options.size+4);}else{$global.css("width",m);}$global.css("cursor","pointer");f($global,options);}else{$global.css("cursor","default");h($global,l,options);}return $global;};function f(k,j){var m=k.attr("id"),l=g("input#"+m+"-score"),i=g("img."+m).length;g("#"+m).mouseleave(function(){a(k,l.val(),j);});g("img."+m).mousemove(function(o){c(m,this.alt,j);if(j.half){var n=parseFloat(((o.pageX-g(this).offset().left)/j.size).toFixed(1));n=(n>=0&&n<0.5)?0.5:1;k.data("score",parseFloat(this.alt)+n-1);b(k,k.data("score"),j);}else{c(m,this.alt,j);}}).click(function(){l.val(j.half?k.data("score"):this.alt);if(j.click){j.click.apply(k,[l.val()]);}});}function e(m,j,i){var k=$global;if(j){if(j.indexOf(".")>=0){var l;return g(j).each(function(){l="#"+g(this).attr("id");if(i=="start"){g.fn.raty.start(m,l);}else{if(i=="click"){g.fn.raty.click(m,l);}else{if(i=="readOnly"){g.fn.raty.readOnly(m,l);}}}});}k=g(j);if(!k.length){d('"'+j+'" is a invalid identifier for the public funtion $.fn.raty.'+i+"().");return;}}return k;}function d(i){if(console&&console.log){console.log(i);}}function c(j,k,r){var l=g("img."+j).length,q=0,o=0,p,m;for(var n=1;n<=l;n++){p=g("img#"+j+"-"+n);if(n<=k){if(r.iconRange&&r.iconRange.length>q){m=r.iconRange[q][0];o=r.iconRange[q][1];if(n<=o){p.attr("src",r.path+m);}if(n==o){q++;}}else{p.attr("src",r.path+r.starOn);}}else{p.attr("src",r.path+r.starOff);}}}function h(j,k,i){if(k!=0){k=parseInt(k);hint=(k>0&&i.number<=i.hintList.length&&i.hintList[k-1]!==null)?i.hintList[k-1]:k;}else{hint=i.noRatedMsg;}g("#"+j.attr("id")).attr("title",hint).children("img").attr("title",hint);}function a(j,k,i){var l=j.attr("id");if(k<0||isNaN(k)){k=0;}else{if(k>i.number){k=i.number;}}g("input#"+l+"-score").val(k);c(l,k,i);if(i.half){b(j,k,i);}if(i.readOnly||j.css("cursor")=="default"){h(j,k,i);}}function b(k,m,j){var n=k.attr("id"),i=Math.ceil(m),l=(i-m).toFixed(1);if(l>=0.3&&l<=0.7){i=i-0.5;g("img#"+n+"-"+Math.ceil(i)).attr("src",j.path+j.starHalf);}else{if(l>=0.8){i--;}else{g("img#"+n+"-"+i).attr("src",j.path+j.starOn);}}}g.fn.raty.click=function(l,j){var k=e(l,j,"click"),i=g(j).data("options");a(k,l,i);if(i.click){i.click.apply(k,[l]);}else{d('You must add the "click: function(score) { }" callback.');}return g.fn.raty;};g.fn.raty.readOnly=function(l,j){var k=e(l,j,"readOnly"),m=k.children("img.button-cancel"),i=g(j).data("options");if(m[0]){(l)?m.hide():m.show();}if(l){g("img."+k.attr("id")).unbind();k.css("cursor","default").unbind();}else{f(k,i);k.css("cursor","pointer");}return g.fn.raty;};g.fn.raty.start=function(l,j){var k=e(l,j,"start"),i=g(j).data("options");a(k,l,i);return g.fn.raty;};g.fn.raty.defaults={cancel:false,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:null,half:false,hintList:["bad","poor","regular","good","gorgeous"],noRatedMsg:"not rated yet",number:5,path:"img/",iconRange:[],readOnly:false,scoreName:"score",size:16,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",start:0,width:null};})(jQuery);