{% extends "geneapro/base.html" %}
{% block title %}GeneaPro: pedigree{% endblock %}
{% block css %}
.pedigree td.indiv {background:url({{MEDIA_URL}}horiz.png) left center no-repeat}

#containers tr > td:first-child {
   text-transform:capitalize;
   font-weight:bold;
   color:#AAA;
}

{% endblock css %}

{% block header %}
<link rel="stylesheet" href="{{MEDIA_URL}}datatables.css"/>
{% endblock header %}

{% block script %}
$(document).ready(function() {
$("#list").dataTable(
  {"bPaginate": false,
   "sDom": '<"top"fi>rt',
   "aaSorting": [[ 2, "asc" ]], // on dates
  }
);
});

{% endblock script %}

{% block endbody %}
{% endblock endbody %}

{% block leftside %}
{% endblock leftside %}

{% block contents %}

<h3 id="title">
   <span class="id">{{p.id}}</span>
   <span class="givenName">{{p.base_given_name}}</span>
   <span class="surName">{{p.base_surname}}</span>
   <span class="details">({{p.birth.date}} - {{p.death.date}})</span>
</h3>

<div id="containers">
 <table id="list">
   <thead>
      <tr>
         <th>Type (Role)</th>
         <th>Name</th>
         <th>Date</th>
         <th>Place</th>
         <th>Assertion</th>
         <th>Sources</th>
      </tr>
   </thead>
   <tbody>

   {% for k, c in chars.items %}
   <tr>
      <td>{{c.char.name}}</td>

      {% if c.parts|length == 1 %}
      <td>{{c.parts.0.value}}</td>
      {% else %}
      <td>
         {% for p in c.parts %}
         <span class="char">{{p.name}}</span>: {{p.value}}<br>
         {% endfor %}
      </td>
      {% endif %}

      <td class="date">{{c.char.Date|default:"-"}}</td>
      <td class="place">{{c.char.place|default:"-"}}</td>
      <td class="assert">
         {{c.assertion.value|linebreaks}}
         <span class="persona">{{c.assertion.person_id}}</span>
         <span class="surety">{{c.assertion.surety}}</span></td>
      <td>
         {% for s in c.char.sources %}
            {% if s %}
         <a href="/sources/{{s}}">{{s}}</a>
            {% endif %}
         {% endfor %}
      </td>
   </tr>
   {% endfor %}

   {% for i, e in events.items %}
      {% if e.assertion.disproved %}
      <tr class="disproved">
      {% else %}
      <tr>
      {% endif %}
         {% if e.role == "principal" %}
         <td>{{e.event.type.name}}</td>
         {% else %}
         <td>{{e.event.type.name}} ({{e.role|default:""}})</td>
         {% endif %}
         <td>{{e.event.name}}</td>
         <td class="date">{{e.event.Date|default:"-"}}</td>
         <td class="place">{{e.event.place|default:"-"|linebreaks}}</td>
         <td class="assert">
            {{e.assertion.value|linebreaks}}
            <span class="persona">{{e.assertion.person_id}}</span>
            <span class="surety">{{e.assertion.surety}}</span></td>
         <td>
            {% for s in e.event.sources %}
               {% if s %}
             <a href="/sources/{{s}}">{{s}}</a>
               {% endif %}
            {% endfor %}
         </td>
      </tr>
   {% endfor %}

   {% for i, g in groups.items %}
      <tr>
         <td>Group</td>
         <td>{{g.group.name}} ({{g.group.role|default:""}})</td>
         <td class="date">{{g.group.date|default:"-"}}</td>
         <td class="place">{{g.group.place|default:"-"}}</td>
         <td class="assert">
            {{g.assertion.value|linebreaks}}
            <span class="persona">{{g.assertion.person_id}}</span>
         <td>
            {% for s in g.group.sources %}
               {% if s %}
            <a href="/sources/{{s}}">{{s}}</a>
               {% endif %}
            {% endfor %}
         </td>
      </tr>

   {% endfor %}
   </tbody>
 </table>

 {% if p2p|length %}
 <p class="onUse" style="margin-top:10px">
 This person is made up of several persona in the database. Each of
 these persona was constructed from one or more sources, and then they
 were all linked together with the following assertions. Disproving any
 of these will change the information displayed above.
 </p>

 <table>
   <thead>
      <tr>
         <th>Persona1</th>
         <th>Persona2</th>
         <th>These are the same because</th>
         <th>Comments</th>
         <th>Surety</th>
      </tr>
   </thead>
   <tbody>
      {% for p in p2p %}
        {% if p.1.person1_id != p.1.person2_id %}
          {% if p.1.disproved %}
      <tr class="disproved">
          {% else %}
      <tr>
          {% endif %}
        {# ??? Should we show sources and researcher #}
        <td><span class="persona">{{p.1.person1_id}}</span></td>
        <td><span class="persona">{{p.1.person2_id}}</span></td>
        <td>{{p.1.rationale|default:""}}</td>
        <td>{{p.1.value|default:""}}</td>
        <td class="surety">{{p.1.surety}}</td>
     </tr>
        {% endif %}
      {% endfor %}
   </tbody>
 </table>
 {% endif %}  {# p2p|length #}

</div>
{% endblock contents %}

